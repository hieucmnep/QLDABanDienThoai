DROP DATABASE DU_AN_1;
go
CREATE DATABASE DU_AN_1;
go
USE DU_AN_1
GO
IF OBJECT_ID('TAIKHOAN') IS NOT NULL 
	DROP TABLE TAIKHOAN
GO
CREATE TABLE TAIKHOAN
(
    MANV NVARCHAR(20) NOT NULL,
    MatKhau NVARCHAR(50) NOT NULL,
    HoTen NVARCHAR(50) NULL,
    VaiTro BIT NOT NULL DEFAULT 0,
    CONSTRAINT PK_TAIKHOAN PRIMARY KEY (MANV)
);
DROP TABLE NHANVIEN
GO
CREATE TABLE NHANVIEN
(IDNV INT IDENTITY(1,1) ,
	MANV NVARCHAR(20) NOT NULL,
	TENNV NVARCHAR(50)  ,
	NGAYSINH DATE  ,
	SDT Nvarchar(50)   ,
	TENTK VARCHAR(50) ,
	CHUCVU	nvarchar(50)  ,
	DIACHI	Nvarchar(50)  ,
	CCCD  Nvarchar(50)  ,
	EMAIL	Nvarchar(50)  ,
	GIOITINH Nvarchar(50)  ,
	THAMNIEN	Nvarchar(50)  ,
	LUONGCB FLOAT,
	HINHANH NVARCHAR(50)  ,
	CONSTRAINT PK_NHANVIEN PRIMARY KEY(MANV),

    CONSTRAINT FK_NHANVIEN_TAIKHOAN FOREIGN KEY (MANV) REFERENCES TAIKHOAN(MANV)
);
--- THÊM DỮ LIỆU 
SELECT NHANVIEN.MANV, TAIKHOAN.VaiTro ,TAIKHOAN.MatKhau
FROM NHANVIEN
JOIN TAIKHOAN ON NHANVIEN.MANV = TAIKHOAN.MANV;

DROP TABLE KHACHHANG
CREATE TABLE KHACHHANG
(
	IDKH INT IDENTITY(1,1) ,
	MAKH VARCHAR(50) PRIMARY KEY ,
	TENKH NVARCHAR(50) NULL,
	NGAYSINH DATE,
	GIOITINH  VARCHAR(20),
	SDT Nvarchar(50)  NULL ,
	TRANGTHAI bit,	
	DIACHI	Nvarchar(50) NULl,
	EMAIL	Nvarchar(50) 
)


SELECT * FROM KHACHHANG WHERE MAKH = 'KH001';
-- Truy vấn lấy thông tin từ cả hai bảng
SELECT KHACHHANG.IDKH,TENKH,SDT,HOADONCT.NGAYMUA,HOADONCT.SOLUONG,DONGIA,TONGTIEN,HOADONCT.TRANGTHAI,TENSP
FROM HOADONCT JOIN KHACHHANG ON  HOADONCT.MAKH = KHACHHANG.MAKH
			JOIN SANPHAMCT ON SANPHAMCT.MASPCT = HOADONCT.MASPCT
			JOIN SANPHAM ON SANPHAM.MASP = SANPHAMCT.MASP

--- THÊM DỮ LIỆU 
DROP TABLE HOADONCT
CREATE TABLE HOADONCT
(
	MAHD VARCHAR(50) NOT NULL,
	MASPCT VARCHAR(50) NOT NULL,
	MAKH VARCHAR(50) NOT NULL,
	MAKM VARCHAR(50) NOT NULL,
	DONGIA FLOAT ,
	SOLUONG INT ,
	TIENKHACHDUA FLOAT ,
	TIENTRALAI FLOAT ,
	NGAYMUA DATE  ,
	HINHTHUCTHANHTOAN  NVARCHAR(50),
	TONGTIEN FLOAT ,
	GHICHU NVARCHAR(50)  ,
	GIAMGIA NVARCHAR(50)  ,
	TRANGTHAI NVARCHAR(50),
	CONSTRAINT PK_HOADONCT PRIMARY KEY(MAHD,MASPCT),
	CONSTRAINT FK_HOADONCT_HOADON FOREIGN KEY(MAHD) REFERENCES HOADON,
	CONSTRAINT FK_HOADONCT_SANPHAMCT FOREIGN KEY(MASPCT) REFERENCES SANPHAMCT, 
	CONSTRAINT FK_HOADONCT_KHUYENMAI FOREIGN KEY(MAKM) REFERENCES KHUYENMAI, 
	CONSTRAINT FK_HOADONCT_KHACHHANG FOREIGN KEY(MAKH) REFERENCES KHACHHANG, 
)

--- THÊM DỮ LIỆU 

CREATE TABLE KHUYENMAI
(
	MAKM  VARCHAR(50) NOT NULL PRIMARY KEY,
	LOAIKM NVARCHAR(50) ,
	THONGTINKM NVARCHAR(50),

)
DROP TABLE HOADON
CREATE TABLE HOADON
(
	MAHD VARCHAR(50) NOT NULL,
	MANV NVARCHAR(20) NOT NULL,
	CONSTRAINT PK_HOADON PRIMARY KEY(MAHD),
	CONSTRAINT FK_HOADON_NHANVIEN FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)
);

--- THÊM DỮ LIỆU 

DROP TABLE SANPHAM
CREATE TABLE SANPHAM
(
	IDSP INT IDENTITY(1,1) ,
	MASP VARCHAR(50) NOT NULL,
	TENSP NVARCHAR(50) NOT NULL,
	THUONGHIEU NVARCHAR(50) NOT NULL,
	CHIP NVARCHAR(50) NOT NULL,
	CAMERA NVARCHAR(50) NOT NULL,
	KICHTHUOC INT NOT NULL,
	CHATLIEU NVARCHAR(50) NOT NULL,
	HEDIEUHANH NVARCHAR(50) NOT NULL,	
	DUNGLUONGPIN NVARCHAR(50) NOT NULL,
	GIA FLOAT NOT NULL ,
	TRANGTHAI INT NOT NULL,
	HINHSP NVARCHAR(50) ,
	CONSTRAINT PK_SANPHAM PRIMARY KEY(MASP)
)
--- THÊM DỮ LIỆU 

ALTER TABLE SANPHAMCT
ADD hidden  BIT DEFAULT 1;
ALTER TABLE SANPHAM
ADD hidden  BIT DEFAULT 1;

DROP TABLE SANPHAMCT
CREATE TABLE SANPHAMCT
(
    ID INT IDENTITY(1, 1),
    MASPCT VARCHAR(50) NOT NULL PRIMARY KEY,
    MAMAU VARCHAR(50) NOT NULL,
    MASP VARCHAR(50) NOT NULL,
    MARAM VARCHAR(50) NOT NULL,
    MANSX VARCHAR(50) NOT NULL,
    NGAYNHAP VARCHAR(50) NOT NULL,
    SOLUONG INT NOT NULL,
    GIANHAP FLOAT NOT NULL,
    CONSTRAINT FK_SPCHITIET FOREIGN KEY (MASP) REFERENCES SANPHAM (MASP),
    CONSTRAINT FK_SPCHITIET_MAUSAC FOREIGN KEY (MAMAU) REFERENCES MAUSAC (MAMAU),
    CONSTRAINT FK_SPCHITIET_RAM FOREIGN KEY (MARAM) REFERENCES RAM (MARAM),
    CONSTRAINT FK_SPCHITIET_NOISANXUAT FOREIGN KEY (MANSX) REFERENCES NOISANXUAT (MANSX)
);

-- THÊM DỮ LIỆU
INSERT INTO SANPHAMCT (MASPCT, MAMAU, MASP, MARAM, MANSX, NGAYNHAP, SOLUONG, GIANHAP)
VALUES
('SPCT001', 'MS001', 'SP001', 'RM001', 'NSX001', '2022-12-01', 100, 600),
('SPCT002', 'MS002', 'SP002', 'RM002', 'NSX002', '2023-01-15', 50, 1200),
('SPCT003', 'MS003', 'SP003', 'RM003', 'NSX003', '2023-02-20', 80, 800),
('SPCT004', 'MS004', 'SP004', 'RM004', 'NSX001', '2023-03-10', 30, 1500),
('SPCT005', 'MS005', 'SP005', 'RM005', 'NSX002', '2023-04-05', 60, 2000);
--- THÊM DỮ LIỆU 

DROP TABLE MAUSAC
CREATE TABLE MAUSAC 
(
	MAMAU VARCHAR(50) NOT NULL PRIMARY KEY,
	TENMAU NVARCHAR(50) NOT NULL,
)
--- THÊM DỮ LIỆU 

DROP TABLE RAM
CREATE TABLE RAM
( 
	MARAM VARCHAR(50) NOT NULL PRIMARY KEY,
	LOAIRAM VARCHAR(50) NOT NULL,
)
--- THÊM DỮ LIỆU 

DROP TABLE NOISANXUAT
CREATE TABLE NOISANXUAT
(
	MANSX VARCHAR(50) NOT NULL PRIMARY KEY,
	NOISANXUAT NVARCHAR(50) NOT NULL, -- NƠI SẢN XUẤT--
)

DROP TABLE KHOHANG
 CREATE TABLE KHOHANG
(
	MASP VARCHAR(50) NOT NULL ,
	IDSP INT IDENTITY(1,1) ,
	TENSP NVARCHAR(50) NOT NULL,
	GIA FLOAT NOT NULL,
	SOLUONG INT NOT NULL,
	CONSTRAINT FK_KHOHANG FOREIGN KEY(MASP) REFERENCES SANPHAM,
)
SELECT DISTINCT KHOHANG.MASP, KHOHANG.TENSP, KHOHANG.SOLUONG, SANPHAM.HEDIEUHANH
FROM SANPHAM
JOIN KHOHANG ON SANPHAM.MASP = KHOHANG.MASP;

SELECT * FROM SANPHAMCT
SELECT * FROM SANPHAM
SELECT * FROM KHOHANG
SELECT * FROM HOADON
SELECT * FROM HOADONCT
SELECT * FROM KHACHHANG
SELECT * FROM NHANVIEN
SELECT * FROM RAM
SELECT * FROM NOISANXUAT
SELECT * FROM MAUSAC
SELECT * FROM TAIKHOAN
	

-- NHÂN VIÊN 
INSERT INTO NHANVIEN (MANV, TENNV, NGAYSINH, SDT, TENTK, CHUCVU, DIACHI, CCCD, EMAIL, GIOITINH, THAMNIEN, LUONGCB, HINHANH)
VALUES
('NV005', N'Ngô Văn Thái', '2004-06-24', '0123456789', 'NGOTHAI', N'Quản lý', N'123 Trịnh Văn Bô', '123456789012', 'thainv@gmail.com', 'Nam', '1 Năm', 1000000, '1.jpg'),
('NV001', N'Lê Đình Linh', '2004-05-15', '0987654321', 'LINH14', N'Nhân viên sale', N'123 Trịnh Văn Bô', '987654321012', 'linh@email.com', 'Nữ', '6 Tháng', 2000000, '2.jpg'),
('NV002', N'Nguyễn Tiến Mạnh', '2004-08-20', '0456789012', 'NGUYENMANH', N'Nhân viên', N'123 Trịnh Văn Bô', '456789012345', 'manhnt@email.com', 'Nữ', '4 Tháng', 4000000, '3.jpg'),
('NV003', N'Lê Khả Hoàng', '2004-12-10', '0555666777', 'KHAHOANG', N'Nhân viên', N'123 Trịnh Văn Bô', '555666777888', 'lkhoang@email.com', 'Nữ', '6 Tháng', 3000000, '4.jpg'),
('NV004', N'Nguyễn Trung Hiếu', '2004-03-25', '0777888999', 'TRUNGHIEU', N'Nhân viên', N'123 Trịnh Văn Bô', '777888999000', 'nghieu@email.com', 'Nữ', '5 Tháng', 1100000, '5.jpg');

-- KHÁCH HÀNG 
INSERT INTO KHACHHANG (MAKH, TENKH, NGAYSINH, GIOITINH, SDT, TRANGTHAI, DIACHI, EMAIL)
VALUES 
('KH001', N'Nguyen Van A', '2003-08-19', N'Nam', '036858383', 1, N'123 Duong ABC', 'nguyenvana@gmail.com'),
('KH002', N'Tran Thi B', '2004-08-20', N'Nu', '096474787', 0, N'456 Duong XYZ', 'tranthib@gmail.com'),
('KH003', N'Le Minh C', '2005-08-02', N'Nam', '034674474', 1, N'789 Duong LMN', 'leminhc@gmail.com'),
('KH004', N'Nguyen Van Hieu', '1999-07-19', N'Nam', '035454554', 1, N'234 Duong HIJ', 'nguyenvanhieu@gmail.com'),
('KH005', N'Tran Thi Linh', '2000-05-19', N'Nu', '02464734747', 0, N'567 Duong UVW', 'tranlinh@gmail.com'),
('KH006', N'Pham Van Thai', '2002-08-22', N'Nam', '0376941599', 1, N'890 Duong XYZ', 'phamthai@gmail.com'),
('KH007', N'Le Hoang', '2001-04-22', N'Nam', '0247585858', 0, N'123 Duong LMN', 'lehoang@gmail.com');

-- HÓA ĐƠN 
INSERT INTO HOADON (MAHD, MANV)
VALUES
('HD001', 'NV001'),
('HD002', 'NV002'),
('HD003', 'NV003'),
('HD004', 'NV004'),
('HD005', 'NV005');


--HÓA ĐƠN CHI TIẾT
INSERT INTO HOADONCT (MAHD, MASPCT,MAKH,MAKM, DONGIA, SOLUONG, TIENKHACHDUA, TIENTRALAI, NGAYMUA, HINHTHUCTHANHTOAN, TONGTIEN, GHICHU, GIAMGIA,TRANGTHAI)
VALUES
('HD001', 'SPCT001','KH001','KM1', 799.99, 2, 1600, 1000, '2023-01-01', N'Tiền mặt', 1599.99, '', '10% ', N'Da Thanh Toan'),
('HD001', 'SPCT002','KH002','KM1', 1299.99, 1, 1300, 0, '2023-01-01', N'Quẹt thẻ ', 1299.99, ' ', '5% ',N'Chua Thanh Toan'),
('HD002', 'SPCT003','KH003','KM2', 299.99, 3, 900, 0, '2023-02-15', N'Chuyển khoản', 899.99, ' ', '15% ',N'Da Thanh Toan'),
('HD002', 'SPCT004','KH004','KM1', 199.99, 1, 200, 0.99, '2023-02-15', N'Thanh toán online', 199.99, '  ', '10%',N'Da Thanh Toan'),
('HD003', 'SPCT005','KH005','KM2', 2499.99, 1, 2500, 0.01, '2023-03-01', N'Chuyển khoản', 2499.99, ' ', '20%',N'Da Thanh Toan');

-- SẢN PHẨM 
-- Thêm sản phẩm điện thoại hiện đại
INSERT INTO SANPHAM (MASP, TENSP, THUONGHIEU, CHIP, CAMERA, KICHTHUOC, CHATLIEU, HEDIEUHANH, DUNGLUONGPIN, GIA, TRANGTHAI, HINHSP)
VALUES
('SP001', N'Samsung Galaxy S21', N'Samsung', N'Exynos 2100', N'108MP', 6.2, N'Glass and Aluminum', N'Android', N'4000mAh', 999.99, 1, 'samsung_s21.jpg'),
('SP002', N'iPhone 13 Pro', N'Apple', N'A15 Bionic', N'Triple 12MP', 6.1, N'Stainless Steel and Ceramic', N'iOS', N'3095mAh', 1299.99, 1, 'iphone_13_pro.jpg'),
('SP003', N'OnePlus 9', N'OnePlus', N'Snapdragon 888', N'48MP', 6.55, N'Glass', N'Android', N'4500mAh', 899.99, 1, 'oneplus_9.jpg'),
('SP004', N'Google Pixel 6', N'Google', N'Tensor', N'Dual 50MP', 6.4, N'Aluminum', N'Android', N'4600mAh', 799.99, 1, 'google_pixel_6.jpg'),
('SP005', N'Xiaomi Mi 11', N'Xiaomi', N'Snapdragon 888', N'108MP', 6.81, N'Glass', N'Android', N'4600mAh', 699.99, 1, 'xiaomi_mi_11.jpg');



-- SẢN PHẨM CHI TIẾT 
-- SẢN PHẨM CHI TIẾT 
INSERT INTO SANPHAMCT (MASPCT, MAMAU, MASP, MARAM, MANSX, NGAYNHAP, SOLUONG, GIANHAP)
VALUES
('SPCT001', 'MS001', 'SP001', 'RM001', 'NSX001', '2022-12-01', 100, 600),
('SPCT002', 'MS002', 'SP002', 'RM002', 'NSX002', '2023-01-15', 50, 1200),
('SPCT003', 'MS003', 'SP003', 'RM003', 'NSX003', '2023-02-20', 80, 800),
('SPCT004', 'MS004', 'SP004', 'RM004', 'NSX001', '2023-03-10', 30, 1500),
('SPCT005', 'MS005', 'SP005', 'RM005', 'NSX002', '2023-04-05', 60, 2000);


--BANG PHỤ SẢN PHẨM CHI TIẾT
INSERT INTO MAUSAC (MAMAU, TENMAU)
VALUES
('MS001', N'Đen'),
('MS002', N'Trắng'),
('MS003', N'Đỏ'),
('MS004', N'Vàng'),
('MS005', N'Xám'),
('MS006', N'Xanh'),
('MS007', N'Nâu'),
('MS008', N'Hồng'),
('MS009', N'Tím');


INSERT INTO RAM (MARAM, LOAIRAM)
VALUES
('RM001', '64GB'),
('RM002', '128GB'),
('RM003', '256GB'),
('RM004', '512GB'),
('RM005', '1T');

INSERT INTO NOISANXUAT (MANSX, NOISANXUAT)
VALUES
('NSX001', N'Việt Nam'),
('NSX002', N'Trung Quốc'),
('NSX003', N'Ấn Độ'),
('NSX004', N'Mỹ'),
('NSX005', N'Hàn Quốc');

-- Update an existing record in MAUSAC
UPDATE MAUSAC
SET TENMAU = 'NewColor'
WHERE MAMAU = 'MS001';
-- BANG PHỤ SẢN PHẨM CHI TIẾT
INSERT INTO MAUSAC (MAMAU, TENMAU)
VALUES
('MS006', 'NewColor');
SELECT * FROM MAUSAC WHERE MAMAU = 'MS001';

-- KHO HÀNG 
INSERT INTO KHOHANG (MASP, TENSP, GIA, SOLUONG)
VALUES
('SP001', 'Smartphone X', 799.99, 50),
('SP002', 'Laptop Pro', 1299.99, 30),
('SP003', 'Tablet Lite', 299.99, 80),
('SP004', 'Smartwatch 2', 199.99, 20),
('SP005', 'Gaming PC', 2499.99, 10);

-- Your insert statement here

SET IDENTITY_INSERT KHACHHANG OFF;
INSERT INTO KHUYENMAI VALUES
('KM1',N'TRONG NGÀY',NULL),
('KM2',N'TRONG TUẦN',NULL);

INSERT INTO TaiKhoan(MANV, MatKhau, HoTen, VaiTro) 
VALUES
('NV001', '123', 'Lê Đình Linh', 1),
('NV002', '123', 'Nguyễn Tiến Mạnh', 1),
('NV003', '123', 'Nguyen Trung Hieu', 1),
('NV004', '123', 'Lê Khả Hoàng', 1),
('NV005', '123', 'Ngô Văn Thái', 1);

SELECT * FROM TaiKhoan where MANV = 'HoangLK'
ALTER TABLE TAIKHOAN
ALTER COLUMN HoTen VARCHAR(255) NULL;
ALTER TABLE SANPHAMCT
ADD hidden  BIT DEFAULT 1;
ALTER TABLE SANPHAM
ADD hidden  BIT DEFAULT 1;
--- THÊM DỮ LIỆU 