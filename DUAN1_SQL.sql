DROP DATABASE DU_AN_1;
go
CREATE DATABASE DU_AN_1;
go
USE DU_AN_1
GO
IF OBJECT_ID('TAIKHOAN') IS NOT NULL 
	DROP TABLE TAIKHOAN
GO
CREATE TABLE TAIKHOAN
(
	MaTK	NVARCHAR(20) NOT NULL,
	MatKhau	NVARCHAR(50) NOT NULL,
	HoTen	NVARCHAR(50) NOT NULL,
	VaiTro	BIT NOT NULL DEFAULT 0,
	CONSTRAINT PK_TAIKHOAN PRIMARY KEY (MaTK)
)

DROP TABLE NHANVIEN
CREATE TABLE NHANVIEN
(
	IDNV INT IDENTITY(1,1) ,
	MANV VARCHAR(50) NOT NULL,
	TENNV NVARCHAR(50) NOT NULL,
	NGAYSINH VARCHAR(50) NOT NULL,
	SDT Nvarchar(50) NOT NULL ,
	TENTK VARCHAR(50) NOT NULL,
	CHUCVU	varchar(50) NOT NULl,
	DIACHI	Nvarchar(50) NOT NULl,
	CCCD  Nvarchar(50) NOT NULL,
	EMAIL	Nvarchar(50) NOT NULl,
	GIOITINH Nvarchar(50)NOT NULl,
	TRANGTHAI	Nvarchar(50) NOT NULl,
	HINHANH NVARCHAR(50) ,
	CONSTRAINT PK_NHANVIEN PRIMARY KEY(MANV),
)
--- THÊM DỮ LIỆU 

DROP TABLE KHACHHANG
CREATE TABLE KHACHHANG
(
	IDKH INT IDENTITY(1,1) ,
	MAKH VARCHAR(50) PRIMARY KEY ,
	TENKH NVARCHAR(50) NULL,
	NGAYSINH DATE,
	GIOITINH  VARCHAR(20),
	SDT Nvarchar(50)  NULL ,
	TRANGTHAI bit,	
	DIACHI	Nvarchar(50) NULl,
	EMAIL	Nvarchar(50) 
)


SELECT * FROM KHACHHANG WHERE MAKH = 'KH001';
-- Truy vấn lấy thông tin từ cả hai bảng
SELECT KHACHHANG.IDKH,TENKH,SDT,HOADONCT.NGAYMUA,HOADONCT.SOLUONG,DONGIA,TONGTIEN,HOADONCT.TRANGTHAI,TENSP
FROM HOADONCT JOIN KHACHHANG ON  HOADONCT.MAKH = KHACHHANG.MAKH
			JOIN SANPHAMCT ON SANPHAMCT.MASPCT = HOADONCT.MASPCT
			JOIN SANPHAM ON SANPHAM.MASP = SANPHAMCT.MASP

--- THÊM DỮ LIỆU 
DROP TABLE HOADONCT
CREATE TABLE HOADONCT
(
	MAHD VARCHAR(50) NOT NULL,
	MASPCT VARCHAR(50) NOT NULL,
	MAKH VARCHAR(50) NOT NULL,
	MAKM VARCHAR(50) NOT NULL,
	DONGIA FLOAT ,
	SOLUONG INT ,
	TIENKHACHDUA FLOAT ,
	TIENTRALAI FLOAT ,
	NGAYMUA DATE  ,
	HINHTHUCTHANHTOAN  NVARCHAR(50),
	TONGTIEN FLOAT ,
	GHICHU NVARCHAR(50)  ,
	GIAMGIA NVARCHAR(50)  ,
	TRANGTHAI NVARCHAR(50),
	CONSTRAINT PK_HOADONCT PRIMARY KEY(MAHD,MASPCT),
	CONSTRAINT FK_HOADONCT_HOADON FOREIGN KEY(MAHD) REFERENCES HOADON,
	CONSTRAINT FK_HOADONCT_SANPHAMCT FOREIGN KEY(MASPCT) REFERENCES SANPHAMCT, 
	CONSTRAINT FK_HOADONCT_KHUYENMAI FOREIGN KEY(MAKM) REFERENCES KHUYENMAI, 
	CONSTRAINT FK_HOADONCT_KHACHHANG FOREIGN KEY(MAKH) REFERENCES KHACHHANG, 
)

--- THÊM DỮ LIỆU 

CREATE TABLE KHUYENMAI
(
	MAKM  VARCHAR(50) NOT NULL PRIMARY KEY,
	LOAIKM NVARCHAR(50) ,
	THONGTINKM NVARCHAR(50),

)
DROP TABLE HOADON
CREATE TABLE HOADON
(
	MAHD VARCHAR(50) NOT NULL,
	MANV VARCHAR(50) NOT NULL,
	CONSTRAINT PK_HOADON PRIMARY KEY(MAHD),
	CONSTRAINT FK_HOADON_NHANVIEN FOREIGN KEY(MANV) REFERENCES NHANVIEN,
)
--- THÊM DỮ LIỆU 

DROP TABLE SANPHAM
CREATE TABLE SANPHAM
(
	IDSP INT IDENTITY(1,1) ,
	MASP VARCHAR(50) NOT NULL,
	TENSP NVARCHAR(50) NOT NULL,
	THUONGHIEU NVARCHAR(50) NOT NULL,
	CHIP NVARCHAR(50) NOT NULL,
	CAMERA NVARCHAR(50) NOT NULL,
	KICHTHUOC INT NOT NULL,
	CHATLIEU NVARCHAR(50) NOT NULL,
	HEDIEUHANH NVARCHAR(50) NOT NULL,	
	DUNGLUONGPIN NVARCHAR(50) NOT NULL,
	GIA FLOAT NOT NULL ,
	TRANGTHAI INT NOT NULL,
	HINHSP NVARCHAR(50) ,
	CONSTRAINT PK_SANPHAM PRIMARY KEY(MASP)
)
--- THÊM DỮ LIỆU 


DROP TABLE SANPHAMCT
CREATE TABLE SANPHAMCT
(
    ID INT IDENTITY(1, 1),
    MASPCT VARCHAR(50) NOT NULL PRIMARY KEY,
    MAMAU VARCHAR(50) NOT NULL,
    MASP VARCHAR(50) NOT NULL,
    MARAM VARCHAR(50) NOT NULL,
    MANSX VARCHAR(50) NOT NULL,
    NGAYNHAP VARCHAR(50) NOT NULL,
    SOLUONG INT NOT NULL,
    GIANHAP FLOAT NOT NULL,
    CONSTRAINT FK_SPCHITIET FOREIGN KEY (MASP) REFERENCES SANPHAM (MASP),
    CONSTRAINT FK_SPCHITIET_MAUSAC FOREIGN KEY (MAMAU) REFERENCES MAUSAC (MAMAU),
    CONSTRAINT FK_SPCHITIET_RAM FOREIGN KEY (MARAM) REFERENCES RAM (MARAM),
    CONSTRAINT FK_SPCHITIET_NOISANXUAT FOREIGN KEY (MANSX) REFERENCES NOISANXUAT (MANSX)
);

-- THÊM DỮ LIỆU
INSERT INTO SANPHAMCT (MASPCT, MAMAU, MASP, MARAM, MANSX, NGAYNHAP, SOLUONG, GIANHAP)
VALUES
('SPCT001', 'MS001', 'SP001', 'RM001', 'NSX001', '2022-12-01', 100, 600),
('SPCT002', 'MS002', 'SP002', 'RM002', 'NSX002', '2023-01-15', 50, 1200),
('SPCT003', 'MS003', 'SP003', 'RM003', 'NSX003', '2023-02-20', 80, 800),
('SPCT004', 'MS004', 'SP004', 'RM004', 'NSX001', '2023-03-10', 30, 1500),
('SPCT005', 'MS005', 'SP005', 'RM005', 'NSX002', '2023-04-05', 60, 2000);
--- THÊM DỮ LIỆU 

CREATE TABLE MAUSAC 
(
	MAMAU VARCHAR(50) NOT NULL PRIMARY KEY,
	TENMAU NVARCHAR(50) NOT NULL,
)
--- THÊM DỮ LIỆU 

CREATE TABLE RAM
( 
	MARAM VARCHAR(50) NOT NULL PRIMARY KEY,
	LOAIRAM VARCHAR(50) NOT NULL,
)
--- THÊM DỮ LIỆU 

CREATE TABLE NOISANXUAT
(
	MANSX VARCHAR(50) NOT NULL PRIMARY KEY,
	NOISANXUAT NVARCHAR(50) NOT NULL, -- NƠI SẢN XUẤT--
)

DROP TABLE KHOHANG
 CREATE TABLE KHOHANG
(
	MASP VARCHAR(50) NOT NULL ,
	IDSP INT IDENTITY(1,1) ,
	TENSP NVARCHAR(50) NOT NULL,
	GIA FLOAT NOT NULL,
	SOLUONG INT NOT NULL,
	CONSTRAINT FK_KHOHANG FOREIGN KEY(MASP) REFERENCES SANPHAM,
)

SELECT * FROM SANPHAMCT
SELECT * FROM SANPHAM
SELECT * FROM HOADON
SELECT * FROM HOADONCT
SELECT * FROM KHACHHANG
SELECT * FROM NHANVIEN
SELECT * FROM KHOHANG
SELECT * FROM RAM
SELECT * FROM NOISANXUAT
SELECT * FROM MAUSAC
	

-- NHÂN VIÊN 
INSERT INTO NHANVIEN (MANV, TENNV, NGAYSINH, SDT, TENTK, CHUCVU, DIACHI, CCCD, EMAIL, GIOITINH, TRANGTHAI, HINHANH)
VALUES
('NV001', 'John Doe', '1990-01-01', '123456789', 'john_doe', 'Manager', '123 Main St', '123456789012', 'john.doe@email.com', 'Male', 'Active', 'profile.jpg'),
('NV002', 'Jane Smith', '1985-05-15', '987654321', 'jane_smith', 'Sales Representative', '456 Oak St', '987654321012', 'jane.smith@email.com', 'Female', 'Active', 'avatar.jpg'),
('NV003', 'Alice Johnson', '1992-08-20', '456789012', 'alice_j', 'IT Specialist', '789 Elm St', '456789012345', 'alice.johnson@email.com', 'Female', 'Active', 'alice.jpg'),
('NV004', 'Bob Wilson', '1980-12-10', '555666777', 'bob_w', 'Marketing Manager', '101 Pine St', '555666777888', 'bob.wilson@email.com', 'Male', 'Inactive', 'bob.jpg'),
('NV005', 'Eva Rodriguez', '1995-03-25', '777888999', 'eva_r', 'HR Coordinator', '222 Maple St', '777888999000', 'eva.rodriguez@email.com', 'Female', 'Active', 'eva.jpg');

-- KHÁCH HÀNG 
INSERT INTO KHACHHANG (MAKH, TENKH, NGAYSINH, GIOITINH, SDT, TRANGTHAI, DIACHI, EMAIL)
VALUES 
('KH001', N'Nguyen Van A', '2003-08-19', N'Nam', '036858383', 1, N'123 Duong ABC', 'nguyenvana@gmail.com'),
('KH002', N'Tran Thi B', '2004-08-20', N'Nu', '096474787', 0, N'456 Duong XYZ', 'tranthib@gmail.com'),
('KH003', N'Le Minh C', '2005-08-02', N'Nam', '034674474', 1, N'789 Duong LMN', 'leminhc@gmail.com'),
('KH004', N'Nguyen Van Hieu', '1999-07-19', N'Nam', '035454554', 1, N'234 Duong HIJ', 'nguyenvanhieu@gmail.com'),
('KH005', N'Tran Thi Linh', '2000-05-19', N'Nu', '02464734747', 0, N'567 Duong UVW', 'tranlinh@gmail.com'),
('KH006', N'Pham Van Thai', '2002-08-22', N'Nam', '0376941599', 1, N'890 Duong XYZ', 'phamthai@gmail.com'),
('KH007', N'Le Hoang', '2001-04-22', N'Nam', '0247585858', 0, N'123 Duong LMN', 'lehoang@gmail.com');

-- HÓA ĐƠN 
INSERT INTO HOADON (MAHD, MANV)
VALUES
('HD001', 'NV001'),
('HD002', 'NV002'),
('HD003', 'NV003'),
('HD004', 'NV004'),
('HD005', 'NV005');


--HÓA ĐƠN CHI TIẾT
INSERT INTO HOADONCT (MAHD, MASPCT,MAKH,MAKM, DONGIA, SOLUONG, TIENKHACHDUA, TIENTRALAI, NGAYMUA, HINHTHUCTHANHTOAN, TONGTIEN, GHICHU, GIAMGIA,TRANGTHAI)
VALUES
('HD001', 'SPCT001','KH001','KM1', 799.99, 2, 1600, 1000, '2023-01-01', N'Tiền mặt', 1599.99, '', '10% ', N'Da Thanh Toan'),
('HD001', 'SPCT002','KH002','KM1', 1299.99, 1, 1300, 0, '2023-01-01', N'Quẹt thẻ ', 1299.99, ' ', '5% ',N'Chua Thanh Toan'),
('HD002', 'SPCT003','KH003','KM2', 299.99, 3, 900, 0, '2023-02-15', N'Chuyển khoản', 899.99, ' ', '15% ',N'Da Thanh Toan'),
('HD002', 'SPCT004','KH004','KM1', 199.99, 1, 200, 0.99, '2023-02-15', N'Thanh toán online', 199.99, '  ', '10%',N'Da Thanh Toan'),
('HD003', 'SPCT005','KH005','KM2', 2499.99, 1, 2500, 0.01, '2023-03-01', N'Chuyển khoản', 2499.99, ' ', '20%',N'Da Thanh Toan');

-- SẢN PHẨM 
-- Thêm sản phẩm điện thoại hiện đại
INSERT INTO SANPHAM (MASP, TENSP, THUONGHIEU, CHIP, CAMERA, KICHTHUOC, CHATLIEU, HEDIEUHANH, DUNGLUONGPIN, GIA, TRANGTHAI, HINHSP)
VALUES
('SP001', N'Samsung Galaxy S21', N'Samsung', N'Exynos 2100', N'108MP', 6.2, N'Glass and Aluminum', N'Android', N'4000mAh', 999.99, 1, 'samsung_s21.jpg'),
('SP002', N'iPhone 13 Pro', N'Apple', N'A15 Bionic', N'Triple 12MP', 6.1, N'Stainless Steel and Ceramic', N'iOS', N'3095mAh', 1299.99, 1, 'iphone_13_pro.jpg'),
('SP003', N'OnePlus 9', N'OnePlus', N'Snapdragon 888', N'48MP', 6.55, N'Glass', N'Android', N'4500mAh', 899.99, 1, 'oneplus_9.jpg'),
('SP004', N'Google Pixel 6', N'Google', N'Tensor', N'Dual 50MP', 6.4, N'Aluminum', N'Android', N'4600mAh', 799.99, 1, 'google_pixel_6.jpg'),
('SP005', N'Xiaomi Mi 11', N'Xiaomi', N'Snapdragon 888', N'108MP', 6.81, N'Glass', N'Android', N'4600mAh', 699.99, 1, 'xiaomi_mi_11.jpg');



-- SẢN PHẨM CHI TIẾT 
-- SẢN PHẨM CHI TIẾT 
INSERT INTO SANPHAMCT (MASPCT, MAMAU, MASP, MARAM, MANSX, NGAYNHAP, SOLUONG, GIANHAP)
VALUES
('SPCT001', 'MS001', 'SP001', 'RM001', 'NSX001', '2022-12-01', 100, 600),
('SPCT002', 'MS002', 'SP002', 'RM002', 'NSX002', '2023-01-15', 50, 1200),
('SPCT003', 'MS003', 'SP003', 'RM003', 'NSX003', '2023-02-20', 80, 800),
('SPCT004', 'MS004', 'SP004', 'RM004', 'NSX001', '2023-03-10', 30, 1500),
('SPCT005', 'MS005', 'SP005', 'RM005', 'NSX002', '2023-04-05', 60, 2000);


--BANG PHỤ SẢN PHẨM CHI TIẾT
INSERT INTO MAUSAC (MAMAU, TENMAU)
VALUES
('MS001', 'Red'),
('MS002', 'Blue'),
('MS003', 'Green'),
('MS004', 'Yellow'),
('MS005', 'Black');
-- Update an existing record in MAUSAC
UPDATE MAUSAC
SET TENMAU = 'NewColor'
WHERE MAMAU = 'MS001';
-- BANG PHỤ SẢN PHẨM CHI TIẾT
INSERT INTO MAUSAC (MAMAU, TENMAU)
VALUES
('MS006', 'NewColor');
SELECT * FROM MAUSAC WHERE MAMAU = 'MS001';

INSERT INTO RAM (MARAM, LOAIRAM)
VALUES
('RM001', '8GB'),
('RM002', '16GB'),
('RM003', '32GB'),
('RM004', '4GB'),
('RM005', '64GB');

INSERT INTO NOISANXUAT (MANSX, NOISANXUAT)
VALUES
('NSX001', 'Vietnam'),
('NSX002', 'China'),
('NSX003', 'USA'),
('NSX004', 'Japan'),
('NSX005', 'South Korea');

-- KHO HÀNG 
INSERT INTO KHOHANG (MASP, TENSP, GIA, SOLUONG)
VALUES
('SP001', 'Smartphone X', 799.99, 50),
('SP002', 'Laptop Pro', 1299.99, 30),
('SP003', 'Tablet Lite', 299.99, 80),
('SP004', 'Smartwatch 2', 199.99, 20),
('SP005', 'Gaming PC', 2499.99, 10);

-- Your insert statement here

SET IDENTITY_INSERT KHACHHANG OFF;
INSERT INTO KHUYENMAI VALUES
('KM1',N'TRONG NGÀY',NULL),
('KM2',N'TRONG TUẦN',NULL);

INSERT INTO TaiKhoan(MaTK,MatKhau,HoTen,VaiTro) values('HoangLK','123456','Le Kha Hoang','true')

SELECT * FROM TaiKhoan where MaTK = 'HoangLK'