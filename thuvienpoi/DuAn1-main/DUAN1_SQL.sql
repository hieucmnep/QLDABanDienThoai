DROP DATABASE duan1
CREATE DATABASE duan1_1
GO
USE duan1_1
GO

DROP TABLE NHANVIEN
CREATE TABLE NHANVIEN
(
	IDNV INT IDENTITY(1,1) ,
	MANV VARCHAR(50) NOT NULL,
	TENNV NVARCHAR(50) NOT NULL,
	NGAYSINH VARCHAR(50) NOT NULL,
	SDT Nvarchar(50) NOT NULL ,
	TENTK VARCHAR(50) NOT NULL,
	CHUCVU	varchar(50) NOT NULl,
	DIACHI	Nvarchar(50) NOT NULl,
	CCCD  Nvarchar(50) NOT NULL,
	EMAIL	Nvarchar(50) NOT NULl,
	GIOITINH Nvarchar(50)NOT NULl,
	TRANGTHAI	Nvarchar(50) NOT NULl,
	HINHANH NVARCHAR(50) ,
	CONSTRAINT PK_NHANVIEN PRIMARY KEY(MANV),
)
--- THÊM DỮ LIỆU 


DROP TABLE KHACHHANG
CREATE TABLE KHACHHANG
(
	IDKH INT IDENTITY(1,1) ,
	MAKH VARCHAR(50) NOT NULL,
	TENKH NVARCHAR(50) NOT NULL,
	NGAYSINH DATE NOT NULL,
	GIOITINH  VARCHAR(20),
	SDT Nvarchar(50) NOT NULL ,
	TRANGTHAI VARCHAR(50) NOT NULL,	
	DIACHI	Nvarchar(50) NOT NULl,
	EMAIL	Nvarchar(50) NOT NULl,
	CONSTRAINT PK_KHACHHANG PRIMARY KEY(MAKH),
	)
--- THÊM DỮ LIỆU 

DROP TABLE HOADONCT
CREATE TABLE HOADONCT
(
	MAHD VARCHAR(50) NOT NULL,
	MASP VARCHAR(50) NOT NULL,
	DONGIA FLOAT NOT NULL,
	SOLUONG INT NOT NULL,
	TIENKHACHDUA FLOAT NOT NULL,
	TIENTRALAI FLOAT NOT NULL,
	NGAYMUA VARCHAR(50) NOT NULL,
	HINHTHUCTHANHTOAN  NVARCHAR(50),
	TONGTIEN FLOAT ,
	GHICHU NVARCHAR(50) NOT NULL,
	GIAMGIA NVARCHAR(50) NOT NULL,
	CONSTRAINT PK_HOADONCT PRIMARY KEY(MAHD,MASP),
	CONSTRAINT FK_HOADONCT_HOADON FOREIGN KEY(MAHD) REFERENCES HOADON,
	CONSTRAINT FK_HOADONCT_SANPHAM FOREIGN KEY(MASP) REFERENCES SANPHAM, 
)
--- THÊM DỮ LIỆU 
select * from HOADONCT

CREATE TABLE HOADON
(
	MAHD VARCHAR(50) NOT NULL ,
	MANV VARCHAR(50) NOT NULL,
	MAKH VARCHAR(50) NOT NULL,
	HINHTHUCTT NVARCHAR(50) NOT NULL,
	TRANGTHAI INT NOT NULL,
	CONSTRAINT PK_HOADON PRIMARY KEY(MAHD),
	CONSTRAINT FK_HOADON_NHANVIEN FOREIGN KEY(MANV) REFERENCES NHANVIEN,
	CONSTRAINT FK_HOADON_KHACHHANG FOREIGN KEY(MAKH) REFERENCES KHACHHANG,
)
--- THÊM DỮ LIỆU 

DROP TABLE SANPHAM
CREATE TABLE SANPHAM
(
	IDSP INT IDENTITY(1,1) ,
	MASP VARCHAR(50) NOT NULL,
	TENSP NVARCHAR(50) NOT NULL,
	THUONGHIEU NVARCHAR(50) NOT NULL,
	CHIP NVARCHAR(50) NOT NULL,
	CAMERA NVARCHAR(50) NOT NULL,
	KICHTHUOC INT NOT NULL,
	CHATLIEU NVARCHAR(50) NOT NULL,
	HEDIEUHANH NVARCHAR(50) NOT NULL,	
	DUNGLUONGPIN NVARCHAR(50) NOT NULL,
	GIA FLOAT NOT NULL ,
	TRANGTHAI INT NOT NULL,
	HINHSP NVARCHAR(50) ,
	CONSTRAINT PK_SANPHAM PRIMARY KEY(MASP)
)
--- THÊM DỮ LIỆU 


DROP TABLE SANPHAMCT
CREATE TABLE SANPHAMCT
(
	ID INT IDENTITY(1,1),
	MASPCT VARCHAR(50) NOT NULL PRIMARY KEY,
	MAMAU VARCHAR(50) NOT NULL,
	MASP VARCHAR(50) NOT NULL,
	MARAM VARCHAR(50) NOT NULL,
	MANSX VARCHAR(50) NOT NULL,
	NGAYNHAP VARCHAR(50) NOT NULL,
	SOLUONG INT NOT NULL,
	GIANHAP FLOAT NOT NULL,
	CONSTRAINT FK_SPCHITIET FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP),
	CONSTRAINT FK_SPCHITIET_MAUSAC FOREIGN KEY(MASP) REFERENCES MAUSAC(MAMAU),
	CONSTRAINT FK_SPCHITIET_RAM FOREIGN KEY(MARAM) REFERENCES RAM(MARAM),
	CONSTRAINT FK_SPCHITIET_NOISANXUAT FOREIGN KEY(MARAM) REFERENCES NOISANXUAT(MANSX),
)
--- THÊM DỮ LIỆU 

CREATE TABLE MAUSAC 
(
	MAMAU VARCHAR(50) NOT NULL PRIMARY KEY,
	TENMAU NVARCHAR(50) NOT NULL,
)
--- THÊM DỮ LIỆU 

CREATE TABLE RAM
( 
	MARAM VARCHAR(50) NOT NULL PRIMARY KEY,
	LOAIRAM VARCHAR(50) NOT NULL,
)
--- THÊM DỮ LIỆU 

CREATE TABLE NOISANXUAT
(
	MANSX VARCHAR(50) NOT NULL PRIMARY KEY,
	NOISANXUAT NVARCHAR(50) NOT NULL, -- NƠI SẢN XUẤT--
)
--- THÊM DỮ LIỆU 

DROP TABLE KHOHANG
 CREATE TABLE KHOHANG
(
	MASP VARCHAR(50) NOT NULL ,
	IDSP INT IDENTITY(1,1) ,
	TENSP NVARCHAR(50) NOT NULL,
	GIA FLOAT NOT NULL,
	SOLUONG INT NOT NULL,
	CONSTRAINT FK_KHOHANG FOREIGN KEY(MASP) REFERENCES SANPHAM,
)


SELECT * FROM SANPHAMCT
SELECT * FROM SANPHAM
SELECT * FROM HOADON
SELECT * FROM HOADONCT
SELECT * FROM KHACHHANG
SELECT * FROM NHANVIEN
SELECT * FROM KHOHANG
SELECT * FROM RAM
SELECT * FROM NOISANXUAT
SELECT * FROM MAUSAC

-- NHÂN VIÊN 
DROP TABLE NHANVIEN
INSERT INTO NHANVIEN (MANV, TENNV, NGAYSINH, SDT, TENTK, CHUCVU, DIACHI, CCCD, EMAIL, GIOITINH, TRANGTHAI, HINHANH)
VALUES
('NV001', N'Nguyễn Huy Hoàng', '1990-01-01', '023456789', 'HuyHoang06', N'Quản Lý', N'Hà Nội', '083456789012', 'huyhoang@email.com', N'NAM', N'ĐANG LÀM VIỆC', 'profile.jpg'),
('NV002', N'Hà Huy Toàn', '1990-08-13', '023456789', 'HuyToan93', N'Nhân Viên', N'Hà Nam', '083456789012', 'huytoan@email.com', N'NAM', N'Đã Nghỉ Việc', 'profile1.jpg'),
('NV003', N'Nguyễn Trà My', '1999-08-01', '023456789', 'Tramy09', N'Nhân Viên', N'Hà Nội', '083456789012', 'tramy@email.com', N'Nữ', N'ĐANG LÀM VIỆC', 'profile2.jpg'),
('NV004', N'Nguyễn Khánh Linh', '1990-07-18', '023456789', 'KhanhLinh08', N'Nhân Viên', N'Hà Nội', '083456789012', 'khanhlinh@email.com', N'NAM', N'ĐANG LÀM VIỆC', 'profile3.jpg'),
('NV005', N'Hà Duy Khánh', '1990-01-01', '023456789', 'DuyKhanh03', N'Nhân Viên', N'Phú Thọ', '083456789012', 'duykhanh@email.com', N'NAM', N'ĐANG LÀM VIỆC', 'profile6.jpg')

-- KHÁCH HÀNG 
INSERT INTO KHACHHANG (MAKH, TENKH, NGAYSINH, GIOITINH, SDT, TRANGTHAI, DIACHI, EMAIL)
VALUES 
('KH001', N'Nguyen Van A', '2003-08-19', N'Nam', '036858383', N'Dang hoat dong', N'123 Duong ABC', 'nguyenvana@gmail.com'),
('KH002', N'Tran Thi B', '2004-08-20', N'Nu', '096474787', N'Khong hoat dong', N'456 Duong XYZ', 'tranthib@gmail.com'),
('KH003', N'Le Minh C', '2005-08-02', N'Nam', '034674474', N'Dang hoat dong', N'789 Duong LMN', 'leminhc@gmail.com'),
('KH004', N'Nguyen Van Hieu', '1999-07-19', N'Nam', '035454554', N'Dang hoat dong', N'234 Duong HIJ', 'nguyenvanhieu@gmail.com'),
('KH005', N'Tran Thi Linh', '2000-05-19', N'Nu', '02464734747', N'Dang hoat dong', N'567 Duong UVW', 'tranlinh@gmail.com'),
('KH006', N'Pham Van Thai', '2002-08-22', N'Nam', '0376941599', N'Khong hoat dong', N'890 Duong XYZ', 'phamthai@gmail.com'),
('KH007', N'Le Hoang', '2001-04-22', N'Nam', '0247585858', N'Dang hoat dong', N'123 Duong LMN', 'lehoang@gmail.com');

UPDATE KHACHHANG
SET NGAYSINH = '2003-08-19'
WHERE MAKH = 'KH006';
UPDATE KHACHHANG
SET TRANGTHAI = 
    CASE 
        WHEN TRANGTHAI = N'Dang hoat dong' THEN N'moi'
        WHEN TRANGTHAI = N'Khong hoat dong' THEN N'Lau nam'
    END;


UPDATE KHACHHANG
SET NGAYSINH = '2003-08-19'
WHERE MAKH = 'KH006'; -- Assuming you want to update the record with MAKH 'KH006'

-- HÓA ĐƠN 
INSERT INTO HOADON (MAHD, MANV, MAKH, HINHTHUCTT, TRANGTHAI)
VALUES
('HD001', 'NV001', 'KH001', 'Cash', 1),
('HD002', 'NV002', 'KH002', 'Credit Card', 1),
('HD003', 'NV003', 'KH003', 'Online Transfer', 1),
('HD004', 'NV004', 'KH004', 'Cash', 0),
('HD005', 'NV005', 'KH005', 'Credit Card', 1);

-- SẢN PHẨM 
INSERT INTO SANPHAM (MASP, TENSP, THUONGHIEU, CHIP, CAMERA, KICHTHUOC, CHATLIEU, HEDIEUHANH, DUNGLUONGPIN, GIA, TRANGTHAI, HINHSP)
VALUES
('SP001', 'Smartphone X', 'BrandX', 'Snapdragon 865', '48MP', 6.4, 'Metal', 'Android', '4000mAh', 799.99, 1, 'phone_x.jpg'),
('SP002', 'Laptop Pro', 'BrandY', 'Intel i7', 'HD Webcam', 15.6, 'Aluminum', 'Windows 10', '5000mAh', 1299.99, 1, 'laptop_pro.jpg'),
('SP003', 'Tablet Lite', 'BrandZ', 'MediaTek 675', '12MP', 10.1, 'Plastic', 'Android', '6000mAh', 299.99, 1, 'tablet_lite.jpg'),
('SP004', 'Smartwatch 2', 'BrandW', 'ARM Cortex', '2MP', NULL, 'Metal', 'Wear OS', '400mAh', 199.99, 0, 'smartwatch_2.jpg'),
('SP005', 'Gaming PC', 'BrandG', 'AMD Ryzen', 'NVIDIA RTX 3080', NULL, 'Aluminum', 'Windows 11', NULL, 2499.99, 1, 'gaming_pc.jpg');


--HÓA ĐƠN CHI TIẾT
INSERT INTO HOADONCT (MAHD, MASP, DONGIA, SOLUONG, TIENKHACHDUA, TIENTRALAI, NGAYMUA, HINHTHUCTHANHTOAN, TONGTIEN, GHICHU, GIAMGIA)
VALUES
('HD001', 'SP001', 799.99, 2, 1600, 0.01, '2023-01-01', 'Cash', 1599.99, 'Good condition', '10% off'),
('HD001', 'SP002', 1299.99, 1, 1300, 0.01, '2023-01-01', 'Credit Card', 1299.99, 'Promotion applied', '5% off'),
('HD002', 'SP003', 299.99, 3, 900, 0.01, '2023-02-15', 'Online Transfer', 899.99, 'Bulk discount', '15% off'),
('HD002', 'SP004', 199.99, 1, 200, 0.01, '2023-02-15', 'Cash', 199.99, 'Limited time offer', '10% off'),
('HD003', 'SP005', 2499.99, 1, 2500, 0.01, '2023-03-01', 'Credit Card', 2499.99, 'Special edition', 'No discount');


-- SẢN PHẨM CHI TIẾT 
INSERT INTO SANPHAMCT (MAMAU, MASP, MARAM, MANSX, NGAYNHAP, SOLUONG, GIANHAP)
VALUES
('MS001', 'SP001', 'RM001', 'NSX001', '2022-12-01', 100, 600),
('MS002', 'SP002', 'RM002', 'NSX002', '2023-01-15', 50, 1200),
('MS003', 'SP003', 'RM003', 'NSX003', '2023-02-20', 80, 800),
('MS004', 'SP004', 'RM002', 'NSX001', '2023-03-10', 30, 1500),
('MS005', 'SP005', 'RM003', 'NSX002', '2023-04-05', 60, 2000);

--BANG PHỤ SẢN PHẨM CHI TIẾT
INSERT INTO MAUSAC (MAMAU, TENMAU)
VALUES
('MS001', 'Red'),
('MS002', 'Blue'),
('MS003', 'Green'),
('MS004', 'Yellow'),
('MS005', 'Black');

INSERT INTO RAM (MARAM, LOAIRAM)
VALUES
('RM001', '8GB'),
('RM002', '16GB'),
('RM003', '32GB'),
('RM004', '4GB'),
('RM005', '64GB');

INSERT INTO NOISANXUAT (MANSX, NOISANXUAT)
VALUES
('NSX001', 'Vietnam'),
('NSX002', 'China'),
('NSX003', 'USA'),
('NSX004', 'Japan'),
('NSX005', 'South Korea');

-- KHO HÀNG 
INSERT INTO KHOHANG (MASP, TENSP, GIA, SOLUONG)
VALUES
('SP001', 'Smartphone X', 799.99, 50),
('SP002', 'Laptop Pro', 1299.99, 30),
('SP003', 'Tablet Lite', 299.99, 80),
('SP004', 'Smartwatch 2', 199.99, 20),
('SP005', 'Gaming PC', 2499.99, 10);